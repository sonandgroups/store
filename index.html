<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonandgroups</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        /* Custom scrollbar for better look */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #a8b0c0;
            border-radius: 20px;
        }
        /* Style for the fixed overlay when the cart is open or modal is active */
        .overlay {
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 40;
        }
        /* Custom style to force 16:9 aspect ratio */
        .aspect-video-custom {
            aspect-ratio: 16 / 9;
        }
        /* Override for Mobile View: Display 2 products per row on small screens (sm) */
        #catalog-container {
            /* Default: 1 column on mobile (xs) */
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        @media (min-width: 450px) and (max-width: 639px) {
            /* Custom breakpoint for better 2-column display on small mobiles */
            #catalog-container {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        /* sm and up: 2 columns, md and up: 3 columns (Tailwind defaults remain) */
        @media (min-width: 640px) {
             #catalog-container {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        @media (min-width: 768px) {
            #catalog-container {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }
        
    </style>
</head>
<body class="pb-16">

    <div id="message-box" class="fixed top-0 left-1/2 -translate-x-1/2 mt-4 z-50 transition-all duration-300 transform opacity-0">
        </div>

    <nav class="sticky top-0 z-30 bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between space-x-2 sm:space-x-4">
            
            <div id="nav-logo-group" class="flex-shrink-0 flex items-center transition-all duration-200">
                <button onclick="toggleMobileSearch(false)" id="mobile-search-close-btn" class="hidden text-gray-500 hover:text-gray-900 p-2 rounded-full hover:bg-gray-100 transition duration-150 mr-2 sm:hidden">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <h1 id="nav-logo-title" class="text-2xl font-extrabold text-indigo-800 tracking-tight transition-opacity duration-200">
              Sonandgroups Store
                </h1>
            </div>
            
            <div id="search-bar-wrapper" class="hidden flex-grow max-w-md sm:flex sm:mx-auto transition-all duration-200">
                <div class="relative w-full">
                    <input type="text" id="product-search" placeholder="Search products by name, material, or size..."
                            class="w-full rounded-full border border-gray-300 shadow-inner p-2.5 pl-10 text-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                            oninput="handleSearch()">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>

            <div class="flex items-center space-x-2 flex-shrink-0">
                <button onclick="toggleMobileSearch(true)" id="mobile-search-open-btn" class="sm:hidden relative p-2 rounded-full hover:bg-indigo-50 transition duration-150">
                    <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </button>
                
                <button onclick="toggleCartSidebar(true)" class="relative p-2 rounded-full hover:bg-indigo-50 transition duration-150 flex-shrink-0">
                    <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span id="cart-count-badge" class="hidden absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">
                        0
                    </span>
                </button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <p class="mt-4 mb-6 text-center text-lg text-gray-600">Browse our unique pieces and place your local pickup order.</p>
        
        <div class="lg:max-w-5xl mx-auto">
             <div id="category-filter-container" class="mb-6 overflow-x-auto whitespace-nowrap pb-2 custom-scroll">
                </div>

            <div id="special-products-container" class="mb-10">
                </div>
            
            <h2 id="catalog-title" class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">All Products</h2>
            <div id="catalog-container" class="grid gap-8">
                </div>
        </div>
    </div>
    
    <div id="cart-overlay" onclick="toggleCartSidebar(false)" class="overlay fixed inset-0 transition-opacity duration-300 opacity-0 pointer-events-none"></div>

    <div id="cart-sidebar" class="fixed top-0 right-0 w-full md:w-96 h-full bg-white transition-transform duration-300 transform translate-x-full z-50 overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6 border-b pb-3">
                <h2 class="text-2xl font-bold text-indigo-800">Your Order</h2>
                <button id="close-cart-btn" onclick="toggleCartSidebar(false)" class="text-gray-500 hover:text-gray-900 p-2 rounded-full hover:bg-gray-100 transition duration-150">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div id="cart-summary-container" class="space-y-4 custom-scroll max-h-52 overflow-y-auto pr-2">
                </div>

            <div id="cart-total-info" class="pt-4 mt-4 border-t border-dashed">
                <div class="flex justify-between font-bold text-xl text-indigo-800">
                    <span>Total:</span>
                    <span id="cart-total">₹0.00</span>
                </div>
            </div>

            <p class="mt-4 text-xs text-red-500 font-semibold">NOTE: This is an order form, not a payment gateway. Payment is handled upon pickup.</p>
            
            <form id="customer-form" class="mt-6 space-y-4">
                <h3 class="text-lg font-semibold text-gray-700 border-t pt-4">Your Contact Details</h3>
                
                <div>
                    <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name *</label>
                    <input type="text" id="fullName" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 border" placeholder="John Doe">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email Address *</label>
                    <input type="email" id="email" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 border" placeholder="you@example.com">
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700">Mobile Number *</label>
                    <input type="tel" id="phone" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 border" placeholder="98765 43210">
                </div>
                <div>
                    <label for="address" class="block text-sm font-medium text-gray-700">Full Pickup Address *</label>
                    <textarea id="address" required rows="2" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 border" placeholder="Gat No. X, Palghar, 401404"></textarea>
                </div>
                <div>
                    <label for="instructions" class="block text-sm font-medium text-gray-700">Special Instructions (e.g., Pickup Time)</label>
                    <textarea id="instructions" rows="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-indigo-500 focus:ring-indigo-500 border" placeholder="Please set aside for Friday pickup at 4 PM."></textarea>
                </div>

                <button type="submit" id="submit-button" class="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-lg transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="button-text">Submit Order</span>
                    <div id="spinner" class="hidden animate-spin h-5 w-5 border-4 border-white border-t-transparent rounded-full mx-auto"></div>
                </button>
            </form>
        </div>
    </div>

<script>
    // --- 1. PRODUCT DATA (EASY ADD PRODUCT CODE) ---
    const products = [
        {
            id: 'DP-001',
            name: 'Geometric Ceramic Vase',
            description: 'Hand-painted matte finish, 8 inches tall. Perfect for minimalist decor.',
            price: 1500.00,
            // UPDATED: 'image_url' is now 'images' (an array)
            images: [
                'https://placehold.co/600x338/374151/FFFFFF?text=Vase+Front', 
                'https://placehold.co/600x338/374151/FFFFFF?text=Vase+Side',
                'https://placehold.co/600x338/374151/FFFFFF?text=Vase+Detail'
            ],
            material: 'Ceramic (Matte Finish)',
            size: '8 inches tall',
            purpose: 'Accent piece for minimalist decor.',
            category: 'Vases & Planters', 
        },
        {
            id: 'DP-002',
            name: 'Abstract Metal Wall Sculpture',
            description: 'A striking 3D piece for a modern living room. Durable iron alloy.',
            price: 8500.00,
            images: [
                'https://placehold.co/600x338/9CA3AF/FFFFFF?text=Sculpture+Wall',
                'https://placehold.co/600x338/9CA3AF/FFFFFF?text=Sculpture+Zoom'
            ],
            material: 'Durable iron alloy',
            size: '24" x 36" (Wall-mounted)',
            purpose: 'Striking visual anchor for modern living.',
            category: 'Wall Decor', 
        },
        {
            id: 'DP-003',
            name: 'Velvet Throw Pillow Set (2)',
            description: 'Luxurious soft velvet pillows. Available in multiple colors.',
            price: 3200.00,
            images: [
                'https://placehold.co/600x338/D1D5DB/1F2937?text=Pillows+Set',
                'https://placehold.co/600x338/D1D5DB/1F2937?text=Pillows+Color'
            ],
            material: 'Luxurious soft velvet',
            size: '18" x 18" per pillow',
            purpose: 'Decorative and comfortable accent for seating or bedding.',
            category: 'Textiles & Cushions', 
        },
        {
            id: 'DP-004',
            name: 'Vintage Style Desk Lamp',
            description: 'Adjustable brass lamp with an antique finish. Adds a warm glow to any space.',
            price: 4500.00,
            images: [
                'https://placehold.co/600x338/4B5563/FFFFFF?text=Lamp+On', 
                'https://placehold.co/600x338/4B5563/FFFFFF?text=Lamp+Off'
            ],
            material: 'Adjustable brass (antique finish)',
            size: '15" height (fully extended)',
            purpose: 'Provides task lighting and adds a warm glow to a workspace.',
            category: 'Lighting', 
        },
        {
            id: 'DP-005',
            name: 'Mobile Stand',
            description: 'Hand-carved wooden mobile stand. Features cable management slot and anti-slip base.',
            price: 899.00,
            images: [
                'https://placehold.co/600x338/6B7280/FFFFFF?text=Mobile+Stand+Front'
            ],
            material: 'Hand-carved wooden',
            size: '4.5" W x 6" H',
            purpose: 'Holds a mobile device securely.',
            category: 'Tabletop Accessories', 
        },
        {
            id: 'DP-006',
            name: 'Terracotta Planter Pot',
            description: 'A rustic, porous pot ideal for indoor plants. Hand-fired finish.',
            price: 550.00,
            images: [
                'https://placehold.co/600x338/8B5CF6/FFFFFF?text=Planter+Top',
                'https://placehold.co/600x338/8B5CF6/FFFFFF?text=Planter+Texture'
            ],
            material: 'Terracotta',
            size: '6" Diameter',
            purpose: 'Functional and decorative home for small to medium plants.',
            category: 'Vases & Planters', 
        },
    ];

    // --- NEW: SPECIAL PRODUCT DATA (EASY ADD SPECIAL PRODUCT) ---
    const specialProducts = [
        {
            id: 'SP-001',
            name: 'Limited Edition Hand-blown Glass Lamp',
            description: 'Unique piece with swirling blue glass. Only 5 units available.',
            price: 12500.00,
            images: [
                'https://placehold.co/600x338/FFA500/FFFFFF?text=Limited+Lamp+Glow',
                'https://placehold.co/600x338/FFA500/FFFFFF?text=Limited+Lamp+Base'
            ],
            material: 'Hand-blown Glass',
            size: '18" Height',
            purpose: 'High-end statement lighting.',
            category: 'Lighting', 
            tag: 'Limited Stock', 
        },
        {
            id: 'SP-002',
            name: 'Marbled Wood Serving Tray',
            description: 'Exotic wood with a natural marbled grain. Ideal for entertaining.',
            price: 4800.00,
            images: [
                'https://placehold.co/600x338/800080/FFFFFF?text=Marbled+Tray+Detail'
            ],
            material: 'Exotic Marbled Wood',
            size: '16" Diameter',
            purpose: 'Luxury serving or coffee table decor.',
            category: 'Tabletop Accessories',
            tag: 'New Arrival',
        },
    ];
    
    // Merge special products into the main map for cart functionality
    const allProducts = [...products, ...specialProducts];
    
    // --- 2. GOOGLE SHEET CONFIGURATION ---
    const GOOGLE_SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbyvGI039GgsGPUdZgU586VrXOQuSBzFFbDfIG0gC-bRGRYuPW7V7ii7NnplneCav9Ja/exec'; 

    // --- 3. STATE MANAGEMENT ---
    const state = {
        cart: {},
        productsMap: allProducts.reduce((map, p) => {
            map[p.id] = p;
            // Add a state variable to track the current image index for each product card
            map[p.id].currentImageIndex = 0; 
            return map;
        }, {}),
        searchTerm: '', 
        selectedCategory: 'All Products', 
    };

    // --- 4. UTILITY FUNCTIONS ---
    
    // Element selectors
    const cartIconBadge = document.getElementById('cart-count-badge');
    const sidebar = document.getElementById('cart-sidebar');
    const overlay = document.getElementById('cart-overlay');
    const logoTitle = document.getElementById('nav-logo-title');
    const searchWrapper = document.getElementById('search-bar-wrapper');
    const searchInput = document.getElementById('product-search');
    const catalogTitle = document.getElementById('catalog-title');

    /** Formats a number to Indian Rupees (₹) currency. */
    function formatCurrency(amount) {
        return new Intl.NumberFormat('en-IN', {
            style: 'currency',
            currency: 'INR',
            minimumFractionDigits: 2,
        }).format(amount);
    }
    
    /** Shows a temporary message box for success/error alerts. (Unchanged) */
    function showMessageBox(message, type = 'success') {
        const box = document.getElementById('message-box');
        let color, icon;
        
        if (type === 'success') {
            color = 'bg-green-500';
            icon = '<svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        } else {
            color = 'bg-red-500';
            icon = '<svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        }

        box.innerHTML = `
            <div class="${color} text-white px-6 py-3 rounded-xl shadow-xl flex items-center">
                ${icon}
                <span>${message}</span>
            </div>
        `;
        box.classList.remove('opacity-0', 'scale-90');
        box.classList.add('opacity-100', 'scale-100');

        setTimeout(() => {
            box.classList.remove('opacity-100', 'scale-100');
            box.classList.add('opacity-0', 'scale-90');
        }, 5000);
    }

    /** Converts the cart object into a human-readable text summary string. (Unchanged) */
    function formatCartForSubmission() {
        const cartItems = Object.entries(state.cart)
            .filter(([, qty]) => qty > 0)
            .map(([id, qty]) => {
                const product = state.productsMap[id];
                const subtotal = (product.price * qty).toFixed(2);
                return `${qty} x ${product.name} (ID: ${id}, ₹${subtotal})`; 
            });

        return cartItems.join(', ');
    }

    /** Calculates and returns the total price of the current cart. (Unchanged) */
    function calculateTotal() {
        return Object.entries(state.cart).reduce((total, [id, qty]) => {
            const product = state.productsMap[id];
            return total + (product.price * qty);
        }, 0);
    }
    
    /** Toggles the visibility of the cart sidebar and overlay. (Unchanged) */
    window.toggleCartSidebar = function(show) {
        if (show) {
            sidebar.classList.remove('translate-x-full');
            overlay.classList.remove('opacity-0', 'pointer-events-none');
            overlay.classList.add('opacity-100', 'pointer-events-auto');
            document.body.style.overflow = 'hidden'; 
        } else {
            sidebar.classList.add('translate-x-full');
            overlay.classList.add('opacity-0', 'pointer-events-none');
            overlay.classList.remove('opacity-100', 'pointer-events-auto');
            document.body.style.overflow = ''; 
        }
    }

    /** Toggles the visibility and layout of the search bar for mobile view. (Unchanged) */
    window.toggleMobileSearch = function(activate = true) {
        if (window.innerWidth >= 640) return; 

        const searchOpenBtn = document.getElementById('mobile-search-open-btn');
        const searchCloseBtn = document.getElementById('mobile-search-close-btn');

        if (activate) {
            logoTitle.classList.add('hidden');
            searchOpenBtn.classList.add('hidden');
            searchCloseBtn.classList.remove('hidden');
            searchWrapper.classList.remove('hidden');
            searchWrapper.classList.add('flex');
            searchWrapper.classList.remove('max-w-md', 'sm:mx-auto'); 
            searchWrapper.classList.add('w-full', 'mx-2');
            setTimeout(() => searchInput.focus(), 100); 
        } else {
            logoTitle.classList.remove('hidden');
            searchOpenBtn.classList.remove('hidden');
            searchCloseBtn.classList.add('hidden');
            searchWrapper.classList.add('hidden');
            searchWrapper.classList.remove('flex');
            searchWrapper.classList.add('max-w-md', 'sm:mx-auto');
            searchWrapper.classList.remove('w-full', 'mx-2');
        }
    }

    /** Handles the search input and triggers filtering (Unchanged) */
    window.handleSearch = function() { 
        state.searchTerm = searchInput.value.toLowerCase().trim();
        filterAndRenderCatalog();
    }
    
    /** Sets the category state and re-renders the catalog (Unchanged) */
    window.setCategory = function(category) {
        state.selectedCategory = category;
        filterAndRenderCatalog();
    }

    /** Filters products based on the current search term AND selected category, then renders. (Unchanged) */
    function filterAndRenderCatalog() {
        let productsToRender = products;
        
        // 1. Filter by Category
        if (state.selectedCategory !== 'All Products') {
            productsToRender = allProducts.filter(product => 
                product.category === state.selectedCategory
            );
            catalogTitle.textContent = state.selectedCategory;
        } else {
            catalogTitle.textContent = 'Product Catalog';
        }

        // 2. Filter by Search Term
        if (state.searchTerm) {
            productsToRender = productsToRender.filter(product => 
                product.name.toLowerCase().includes(state.searchTerm) ||
                product.description.toLowerCase().includes(state.searchTerm) ||
                product.material.toLowerCase().includes(state.searchTerm) || 
                product.size.toLowerCase().includes(state.searchTerm) ||
                product.purpose.toLowerCase().includes(state.searchTerm) ||
                product.category.toLowerCase().includes(state.searchTerm) ||
                (product.tag && product.tag.toLowerCase().includes(state.searchTerm))
            );
            if (state.selectedCategory === 'All Products') {
                catalogTitle.textContent = `Search Results for "${state.searchTerm}"`;
            }
        }
        
        if (state.selectedCategory !== 'All Products' || state.searchTerm) {
            renderSpecialProducts([]); 
            renderCatalog(productsToRender);
        } else {
            renderSpecialProducts(specialProducts);
            renderCatalog(products); 
        }

        renderCategoryFilter(); 
    }
    
    // --- 5. IMAGE SLIDER LOGIC ---

    /** * Handles changing the image for a specific product card.
     * @param {string} id - Product ID
     * @param {number} delta - 1 for next, -1 for previous
     */
    window.changeImage = function(id, delta) {
        const product = state.productsMap[id];
        if (!product || !product.images || product.images.length < 2) return;

        let currentIndex = product.currentImageIndex || 0;
        const newIndex = (currentIndex + delta + product.images.length) % product.images.length;
        
        product.currentImageIndex = newIndex;
        
        // Find and update the image element directly
        const imageElement = document.getElementById(`product-image-${id}`);
        const indicatorContainer = document.getElementById(`image-indicators-${id}`);

        if (imageElement) {
            imageElement.src = product.images[newIndex];
            
            // Re-render indicators
            if (indicatorContainer) {
                indicatorContainer.innerHTML = product.images.map((_, index) => `
                    <span class="w-2 h-2 rounded-full mx-0.5 ${index === newIndex ? 'bg-white' : 'bg-gray-400 opacity-60'}"></span>
                `).join('');
            }
        }
    }

    // --- 6. RENDER FUNCTIONS ---

    /** Renders the featured special products section. (Uses the same product card) */
    function renderSpecialProducts(productsToRender) {
        const container = document.getElementById('special-products-container');
        
        if (productsToRender.length === 0) {
            container.innerHTML = '';
            return;
        }

        // Use the renderProductCard helper, passing true for isSpecial
        const itemsHtml = productsToRender.map(product => renderProductCard(product, true)).join('');

        container.innerHTML = `
            <h2 class="text-3xl font-bold text-red-600 mb-6 border-b-2 border-red-200 pb-2 flex items-center">
                <svg class="w-7 h-7 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.97 2.887a1 1 0 00-.363 1.118l1.519 4.674c.3.921-.755 1.688-1.538 1.118l-3.97-2.887a1 1 0 00-1.176 0l-3.97 2.887c-.783.57-1.838-.197-1.538-1.118l1.519-4.674a1 1 0 00-.363-1.118L2.094 10.1c-.783-.57-.381-1.81.588-1.81h4.915a1 1 0 00.95-.69l1.519-4.674z"></path></svg>
                Special Products & Limited Editions
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                ${itemsHtml}
            </div>
        `;
    }

    /** Helper function to render a single product card (includes image slider UI) */
    function renderProductCard(product, isSpecial = false) {
        const badgeColor = isSpecial ? 'bg-red-600' : 'bg-indigo-500';
        const badgeText = product.tag ? product.tag : product.category;
        const currentImage = product.images[product.currentImageIndex || 0] || 'https://placehold.co/600x338/cccccc/333333?text=Image+Missing';
        const hasMultipleImages = product.images && product.images.length > 1;

        return `
            <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-gray-100 flex flex-col">
                <div class="w-full aspect-video-custom overflow-hidden relative group">
                    <img id="product-image-${product.id}" src="${currentImage}" 
                        alt="${product.name}" class="w-full h-full object-cover transition-opacity duration-300">
                    
                    ${hasMultipleImages ? `
                        <button onclick="event.stopPropagation(); changeImage('${product.id}', -1)" 
                                class="absolute left-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-30 group-hover:bg-opacity-50 text-white p-2 rounded-full transition-opacity duration-300 opacity-0 group-hover:opacity-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <button onclick="event.stopPropagation(); changeImage('${product.id}', 1)" 
                                class="absolute right-2 top-1/2 -translate-y-1/2 bg-black bg-opacity-30 group-hover:bg-opacity-50 text-white p-2 rounded-full transition-opacity duration-300 opacity-0 group-hover:opacity-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        <div id="image-indicators-${product.id}" class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex justify-center">
                            ${product.images.map((_, index) => `
                                <span class="w-2 h-2 rounded-full mx-0.5 transition-colors duration-200 ${index === product.currentImageIndex ? 'bg-white' : 'bg-gray-400 opacity-60'}"></span>
                            `).join('')}
                        </div>
                    ` : ''}

                </div>
                
                <div class="p-4 flex-grow flex flex-col justify-between">
                    <div>
                        <span class="text-xs text-white font-semibold uppercase px-2 py-0.5 rounded-full ${badgeColor}">${badgeText}</span>
                        <h3 class="text-xl font-semibold text-gray-900 mt-2">${product.name}</h3>
                        <p class="text-sm text-gray-500 mt-1 h-12 overflow-hidden">${product.description}</p>
                        
                        <div class="mt-3 text-xs text-gray-600 space-y-1 p-2 bg-gray-50 rounded-lg border border-gray-200">
                            <p><span class="font-semibold text-gray-700">Material:</span> ${product.material}</p>
                            <p><span class="font-semibold text-gray-700">Size:</span> ${product.size}</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mt-3 pt-3 border-t border-dashed">
                        <span class="text-2xl font-bold text-indigo-600">${formatCurrency(product.price)}</span>
                        <div class="flex items-center space-x-2">
                            ${state.cart[product.id] && state.cart[product.id] > 0 ? `
                                <button onclick="updateCart('${product.id}', -1)" class="bg-red-100 text-red-600 p-2 rounded-full hover:bg-red-200 transition duration-150">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                                </button>
                                <span class="font-medium text-gray-700">${state.cart[product.id]}</span>
                                <button onclick="updateCart('${product.id}', 1)" class="bg-indigo-100 text-indigo-600 p-2 rounded-full hover:bg-indigo-200 transition duration-150">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>
                                </button>
                            ` : `
                                <button onclick="updateCart('${product.id}', 1)" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                                    Add to Order
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    /** Renders the product catalog based on the array provided. (Unchanged) */
    function renderCatalog(productsToRender) {
        const container = document.getElementById('catalog-container');
        
        if (productsToRender.length === 0) {
            const message = state.searchTerm 
                ? `<span class="font-bold">No products found</span> matching criteria.`
                : `<span class="font-bold">No products available</span> in the selected category.`;

            container.innerHTML = `<p class="text-center text-xl text-gray-500 col-span-full py-10">
                ${message}
            </p>`;
            return;
        }

        container.innerHTML = productsToRender.map(product => renderProductCard(product)).join('');
    }


    /** Generates and renders the category filter buttons. (Unchanged) */
    function renderCategoryFilter() {
        const container = document.getElementById('category-filter-container');
        const categories = [...new Set(allProducts.map(p => p.category))].sort();
        categories.unshift('All Products');

        const buttonsHtml = categories.map(category => {
            const isActive = category === state.selectedCategory && !state.searchTerm ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300';
            return `
                <button onclick="setCategory('${category}')" 
                        class="inline-block px-4 py-2 mr-2 mb-2 rounded-full font-medium text-sm transition duration-150 ${isActive}">
                    ${category}
                </button>
            `;
        }).join('');

        container.innerHTML = buttonsHtml;
    }

    /** Renders the current cart summary and total. (Unchanged) */
    function renderCart() {
        const container = document.getElementById('cart-summary-container');
        const totalElement = document.getElementById('cart-total');
        const submitButton = document.getElementById('submit-button');

        const cartItemsHtml = Object.entries(state.cart)
            .filter(([, qty]) => qty > 0)
            .map(([id, qty]) => {
                const product = state.productsMap[id];
                return `
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <div class="flex-grow">
                            <p class="text-sm font-medium text-gray-800">${product.name}</p>
                            <p class="text-xs text-gray-500">${formatCurrency(product.price)} ea.</p>
                        </div>
                        <div class="flex items-center space-x-2 ml-4">
                            <button onclick="updateCart('${id}', -1)" class="text-indigo-600 hover:text-red-700 transition duration-150 p-1">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                            </button>
                            <span class="font-bold text-gray-700 w-4 text-center">${qty}</span>
                            <button onclick="updateCart('${id}', 1)" class="text-indigo-600 hover:text-indigo-700 transition duration-150 p-1">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        
        const totalCount = Object.values(state.cart).reduce((sum, qty) => sum + qty, 0);

        if (cartItemsHtml.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 py-4">Your order is empty. Start adding products!</p>';
            submitButton.disabled = true;
        } else {
            container.innerHTML = cartItemsHtml;
            submitButton.disabled = false;
        }
        
        if (totalCount > 0) {
            cartIconBadge.textContent = totalCount;
            cartIconBadge.classList.remove('hidden');
        } else {
            cartIconBadge.classList.add('hidden');
        }

        totalElement.textContent = formatCurrency(calculateTotal());
        
        filterAndRenderCatalog(); 
    }

    // --- 7. USER INTERACTION LOGIC ---

    /** Adds or removes a quantity of an item from the cart. (Unchanged) */
    window.updateCart = function(id, delta) {
        state.cart[id] = (state.cart[id] || 0) + delta;
        if (state.cart[id] <= 0) {
            delete state.cart[id];
        }
        renderCart();
    }

    /** Handles the form submission and sends data to Google Sheet endpoint. (Unchanged) */
    async function submitOrder(event) {
        event.preventDefault();

        const form = event.target;
        const fullName = form.elements.fullName.value.trim();
        const email = form.elements.email.value.trim();
        const phone = form.elements.phone.value.trim();
        const address = form.elements.address.value.trim(); 
        const instructions = form.elements.instructions.value.trim();
        const cartTotal = calculateTotal();
        const orderSummary = formatCartForSubmission();

        if (cartTotal === 0) {
            showMessageBox('Please add products to your order before submitting.', 'error');
            toggleCartSidebar(true); 
            return;
        }
        
        if (!GOOGLE_SHEET_ENDPOINT.startsWith('http')) {
             showMessageBox('The Google Apps Script URL has not been configured. Please check the code.', 'error');
             return;
        }
        
        const submitButton = document.getElementById('submit-button');
        const buttonText = document.getElementById('button-text');
        const spinner = document.getElementById('spinner');

        buttonText.classList.add('hidden');
        spinner.classList.remove('hidden');
        submitButton.disabled = true;

        const payload = {
            Timestamp: new Date().toISOString(),
            'Customer Name': fullName,
            'Mobile Number': phone,
            'Email': email,
            'Address': address, 
            'Order Total': formatCurrency(cartTotal), 
            'Order Summary': orderSummary,
            'Instructions': instructions,
        };

        try {
            await fetch(GOOGLE_SHEET_ENDPOINT, {
                method: 'POST',
                mode: 'no-cors', 
                cache: 'no-cache',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            showMessageBox('Order submitted successfully! We will contact you soon.', 'success');
            
            form.reset();
            state.cart = {};
            renderCart();
            toggleCartSidebar(false); 

        } catch (error) {
            console.error('Submission Error:', error);
            showMessageBox('An error occurred during submission. Please check your network or the endpoint URL.', 'error');
        } finally {
            buttonText.classList.remove('hidden');
            spinner.classList.add('hidden');
            submitButton.disabled = false;
        }
    }

    // --- 8. INITIALIZATION ---

    document.addEventListener('DOMContentLoaded', () => {
        // Initialize the catalog and special products
        filterAndRenderCatalog();
        renderCart(); 
        document.getElementById('customer-form').addEventListener('submit', submitOrder);
    });

</script>
</body>
</html>
